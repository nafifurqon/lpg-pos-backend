# 2026-02-27 17.10.58-TASK-Standardize Response Format-LPG-1

| Field       | Value                          |
|-------------|--------------------------------|
| **ID**      | LPG-1                          |
| **Type**    | Task                           |
| **Status**  | Done                           |
| **Feature** | cross-cutting / response-shape |

## Objective / Summary

Standardize all backend HTTP response bodies into a single consistent envelope.

Currently, NestJS returns success responses with ad-hoc shapes (e.g., `{ access_token, refresh_token }` directly) and error responses where `message` can be either a `string` or `string[]` depending on whether the error originates from `ValidationPipe` or a manually thrown `HttpException`. This inconsistency forces the frontend to handle multiple shapes.

The goal is to enforce:

- **Success:** `{ message: string, result: T }` for single resources, `{ message: string, result: T[], metadata: { total_items: number, total_pages: number } }` for lists.
- **Error:** `{ messages: string[], error: string }` — `messages` is always an array, `statusCode` is removed from the body (it is already present in the HTTP status header).

## Scope

### In Scope

- Create `src/common/decorators/response-message.decorator.ts` — `@ResponseMessage(msg: string)` decorator using `SetMetadata`
- Create `src/common/interceptors/transform.interceptor.ts` — `TransformInterceptor` that wraps all success responses in the standard envelope by reading the `response_message` metadata via `Reflector`
- Create `src/common/filters/http-exception.filter.ts` — `HttpExceptionFilter` that normalizes all `HttpException` error responses: `message` always becomes `messages: string[]`, `statusCode` is removed from the body
- Update `src/main.ts` — register `HttpExceptionFilter` as global filter and `TransformInterceptor` as global interceptor (injecting `Reflector` via `app.get(Reflector)`)
- Update `src/auth/auth.controller.ts` — decorate every handler with `@ResponseMessage(...)`, remove `@HttpCode(HttpStatus.NO_CONTENT)` from `logout`
- Remove `throw new BadRequestException('Test')` from `src/auth/auth.service.ts`

### Out of Scope

- Frontend type and API layer changes (deferred to a separate task)
- Non-`HttpException` errors (e.g., unexpected 500s from unhandled exceptions) — handled by NestJS default exception handler

## Acceptance Criteria

- [x] `POST /auth/register` with valid body returns `{ message: "Berhasil mendaftar", result: { access_token, refresh_token } }`
- [x] `POST /auth/register` with empty body returns `{ messages: ["Email wajib diisi", ...], error: "Bad Request" }` — `messages` is always an array, no `statusCode` in body
- [x] `POST /auth/register` with duplicate email returns `{ messages: ["Email sudah terdaftar"], error: "Conflict" }`
- [x] `POST /auth/logout` returns HTTP 200 with `{ message: "Berhasil keluar", result: null }`
- [x] All other auth endpoints (`/login`, `/google`, `/refresh`) return the standard `{ message, result }` envelope
- [x] `npx tsc --noEmit` in `backend/` passes with zero errors
