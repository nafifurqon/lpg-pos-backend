# 2026-02-28 00.00.00-TASK-Include User In Auth Response-LPG-3

| Field       | Value              |
|-------------|--------------------|
| **ID**      | LPG-3              |
| **Type**    | Task               |
| **Status**  | Done               |
| **Feature** | auth               |

## Objective / Summary

Extend all backend auth endpoints to include the authenticated user's basic profile (`id`, `email`, `role`) alongside the token pair in the response body.

Currently, `POST /auth/register`, `POST /auth/login`, `POST /auth/google`, and `POST /auth/refresh` only return `{ access_token, refresh_token }`. The frontend auth store needs user identity at login/register time to populate its state without a second network request or client-side JWT decoding.

## Scope

### In Scope

- Add a new exported `AuthResult` type to `src/auth/auth.service.ts` that extends `TokenPair` with a `user` block: `{ id, email, role }`
- Update `issueTokenPair` private helper to return `AuthResult`
- Update `registerWithEmail`, `loginWithEmail`, and `loginWithGoogle` return types from `TokenPair` to `AuthResult`
- Update `refreshTokens` to construct and include the `user` block from its existing parameters
- Frontend: update `AuthResponse` type and auth store to consume the new shape
- Frontend: wire all three mock API functions (`registerWithEmail`, `loginWithEmail`, `loginWithGoogle`) to real backend calls
- Frontend: wire `createShop` mock to real backend call
- Frontend: add `refreshTokens` and `logoutApi` API functions; add refresh-with-retry interceptor in Axios client
- Frontend: add `GET /dashboard` call on `DashboardPage` mount for silent auth verification

### Out of Scope

- Adding a `name` field to the `User` entity (deferred to a separate task)
- Changing the JWT payload shape (no `name` in the token)
- Any database migration

## Acceptance Criteria

- [x] `POST /auth/register` returns `{ message, result: { access_token, refresh_token, user: { id, email, role } } }`
- [x] `POST /auth/login` returns same shape
- [x] `POST /auth/google` returns same shape
- [x] `POST /auth/refresh` returns same shape (user block constructed from JWT payload, no extra DB call)
- [x] Frontend: registering a new user writes `access_token` and `refresh_token` to `localStorage`; auth store holds `user.id`, `user.email`, `user.role`
- [x] Frontend: a `401` response on any protected request triggers a silent `POST /auth/refresh`; original request retries with the new access token; only redirects to `/login` if the refresh itself also fails
- [x] Frontend: `POST /auth/logout` is called with the stored refresh token before clearing auth state
- [x] Frontend: `GET /dashboard` is called on `DashboardPage` mount; a `401` here triggers the same refresh-retry flow
- [x] `npx tsc --noEmit` passes in both `backend/` and `frontend/` with zero errors
